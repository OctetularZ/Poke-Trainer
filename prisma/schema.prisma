generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// Users
model User {
  id            String    @id
  name          String
  email         String
  emailVerified Boolean
  image         String?
  createdAt     DateTime
  updatedAt     DateTime
  sessions      Session[]
  accounts      Account[]

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime
  updatedAt DateTime
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime
  updatedAt             DateTime

  @@map("account")
}

model Verification {
  id         String    @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?

  @@map("verification")
}

// -----------------------------
// Pokemon
model Pokemon {
  id             Int     @id @default(autoincrement())
  nationalNumber String
  name           String  @unique
  slug           String  @unique
  pokeapiId      Int?
  species        String?
  height         String?
  weight         String?
  evYield        String?
  catchRate      String?
  baseFriendship String?
  baseExp        String?
  growthRate     String?
  gender         Json?
  // genderMalePercent   Float?
  // genderFemalePercent Float?
  // genderless          Boolean @default(false)
  eggCycles      String?

  // Base stats
  hpBase      Int?
  hpMin       Int?
  hpMax       Int?
  attackBase  Int?
  attackMin   Int?
  attackMax   Int?
  defenseBase Int?
  defenseMin  Int?
  defenseMax  Int?
  spAtkBase   Int?
  spAtkMin    Int?
  spAtkMax    Int?
  spDefBase   Int?
  spDefMin    Int?
  spDefMax    Int?
  speedBase   Int?
  speedMin    Int?
  speedMax    Int?

  // Relations
  evolvesFrom  Evolution[]          @relation("EvolvesFrom")
  evolvesTo    Evolution[]          @relation("EvolvesTo")
  types        PokemonType[]
  abilities    PokemonAbility[]
  forms        PokemonForm[]
  descriptions GameDescription[]
  typeChart    TypeEffectiveness[]
  gameMoves    GameMove[]
  eggGroups    EggGroup[]
  translations PokemonTranslation[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Evolution {
  id     Int    @id @default(autoincrement())
  method String // i.e. "Level 16", "Fire Stone", etc.

  fromPokemon   Pokemon @relation("EvolvesFrom", fields: [fromPokemonId], references: [id])
  fromPokemonId Int

  toPokemon   Pokemon @relation("EvolvesTo", fields: [toPokemonId], references: [id])
  toPokemonId Int

  @@unique([fromPokemonId, toPokemonId])
}

// Good
model PokemonType {
  id      Int       @id @default(autoincrement())
  name    String    @unique
  pokemon Pokemon[]
}

// Good
model PokemonAbility {
  id      Int       @id @default(autoincrement())
  name    String    @unique
  pokemon Pokemon[]
}

// Good
model PokemonForm {
  id        Int     @id @default(autoincrement())
  name      String
  pokemon   Pokemon @relation(fields: [pokemonId], references: [id])
  pokemonId Int

  @@unique([pokemonId, name])
}

// Good
model EggGroup {
  id      Int       @id @default(autoincrement())
  name    String    @unique
  pokemon Pokemon[]
}

// Good
model TypeEffectiveness {
  id         Int     @id @default(autoincrement())
  pokemon    Pokemon @relation(fields: [pokemonId], references: [id])
  pokemonId  Int
  attackType String
  multiplier String?

  @@unique([pokemonId, attackType])
}

// Good
model GameMove {
  id        Int     @id @default(autoincrement())
  game      Game    @relation(fields: [gameId], references: [id])
  gameId    Int
  move      Move    @relation(fields: [moveId], references: [id])
  moveId    Int
  pokemon   Pokemon @relation(fields: [pokemonId], references: [id])
  pokemonId Int
  method    String // e.g. "Level up", "TM", "Egg move"
  level     String? // e.g. "15", or null for TM
  tmNumber  String? // optional
}

// Good
model Move {
  id          Int        @id @default(autoincrement())
  name        String     @unique
  type        String
  category    String
  power       String?
  accuracy    String?
  pp          String?
  description String?
  priority    String?
  effect      String?
  target      String?
  gameMoves   GameMove[]
}

// Good - Might add more game info later
model Game {
  id       Int        @id @default(autoincrement())
  name     String     @unique
  GameMove GameMove[]
}

// Good
model GameDescription {
  id          Int     @id @default(autoincrement())
  pokemon     Pokemon @relation(fields: [pokemonId], references: [id])
  pokemonId   Int
  game        String
  description String

  @@unique([pokemonId, game])
}

// Good
model PokemonTranslation {
  id             Int     @id @default(autoincrement())
  pokemon        Pokemon @relation(fields: [pokemonId], references: [id])
  pokemonId      Int
  language       String
  translatedName String

  @@unique([pokemonId, language])
}
